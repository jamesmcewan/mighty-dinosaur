---
import { getCollection, render } from "astro:content"
import ArticleBlock from "@/components/block/article-block.astro"
import BackBlock from "@/components/block/back-block.astro"
import SingleColumnLayout from "@/layouts/single-column-layout.astro"

export async function getStaticPaths() {
	const posts = await getCollection("posts")
	const published = posts.filter((post) => !post.data.draft)
	return published.map((post) => ({
		params: { slug: post.data.slug },
		props: { post },
	}))
}

const { post } = Astro.props
const { Content } = await render(post)
const { title, category, description } = post.data
const url = `${import.meta.env.SITE}post/${post.data.slug}`
---

<SingleColumnLayout {description} {title} {url}>
  <ArticleBlock {title} {category}>
    <Content />
  </ArticleBlock>
  <BackBlock />
</SingleColumnLayout>
